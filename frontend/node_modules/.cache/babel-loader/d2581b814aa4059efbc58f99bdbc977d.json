{"ast":null,"code":"var _jsxFileName = \"/Users/mandyhe/cs0320/term-project-awhite35-mcamach6-mhe26-pmontei1/frontend/src/survey_display/Survey.js\",\n    _s = $RefreshSig$();\n\nimport Question from \"./Question\";\nimport React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport firebase from \"firebase\";\nimport axios from \"axios\";\nimport fire from '../fire';\nimport \"./Survey.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Survey(props) {\n  _s();\n\n  const [title, setTitle] = useState(\"loading...\");\n  const [surveyCreator, setCreator] = useState(\"\"); // use this to check if button should show up\n\n  const [description, setDescription] = useState(\"almost there...\");\n  const [questions, setQuestions] = useState([]);\n  const [userAnswers, setUserAnswers] = useState([]);\n  const [error, setError] = useState(\"\");\n  const db = firebase.firestore();\n  const currentPoll = props.uniqueID;\n\n  const loadSurvey = async () => {\n    const doc = await db.collection(\"surveys\").doc(currentPoll).get();\n    setTitle(doc.data().title);\n    setCreator(doc.data().creator); // sets creator --> if current user matches this, display button to get results\n\n    setDescription(doc.data().description);\n    const ndoc = await db.collection(\"surveys\").doc(currentPoll).collection(\"questions\").orderBy(\"questionnumber\").get();\n    await setQuestions(ndoc.docs.map(d => d.data()));\n    let answers = new Array(ndoc.docs.length); // store answer as -1 if user hasn't answered\n\n    console.log(answers.length);\n\n    for (let i = 0; i < answers.length; i++) {\n      answers[i] = -1;\n    }\n\n    setUserAnswers(answers);\n\n    if ((await db.collection(\"surveys\").doc(currentPoll).collection(\"responses\").doc(firebase.auth().currentUser.uid).get()).exists) {\n      document.getElementById(\"linkToCheckResults\").style.visibility = \"visible\";\n    }\n  };\n\n  const sendResults = async () => {\n    // make a new document for submitting\n    // makes the document id the same as the user id and also overrides previous changes if the user\n    // submits twice\n    let responsesRef = db.collection(\"surveys\").doc(currentPoll).collection(\"responses\");\n    await responsesRef.doc(firebase.auth().currentUser.uid).set({\n      userID: firebase.auth().currentUser.uid,\n      email: firebase.auth().currentUser.email,\n      name: firebase.auth().currentUser.displayName,\n      responses: userAnswers\n    }).then(() => {\n      setError(\"Successfully submitted survey response!\");\n      document.getElementById(\"linkToCheckResults\").style.visibility = \"visible\";\n      console.log(\"submitted survey response!\");\n    }).catch(error => {\n      console.error(\"Error making survey: \", error);\n      setError(\"Error submitting survey: \" + error);\n    }); // should we add a timestamp?\n  }; // on page load, load in the survey\n\n\n  useEffect(() => {\n    loadSurvey();\n  }, []); // set ID, used in child component\n\n  const setAnswerFromChild = (questionID, answer) => {\n    if (userAnswers) {\n      userAnswers[questionID] = answer;\n    }\n  }; // attempt to submit survey\n\n\n  const submitSurvey = () => {\n    console.log(userAnswers); // make sure each answer isn't null\n\n    let valid = true;\n\n    for (let i = 0; i < userAnswers.length; i++) {\n      if (userAnswers[i] === -1) {\n        valid = false;\n      }\n    }\n\n    if (valid) {\n      console.log(\"attempting to submit...\");\n      sendResults();\n    } else {\n      console.log(\"you didn't pick answer choices :(\");\n      setError(\"Please answer every question!\");\n    }\n  }; // checking if user is admin is hard coded in --> will be used to display button for survey results.\n\n\n  console.log(db.collection(\"surveys\").doc(currentPoll).id);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"div1\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"poll\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"surveyInfo\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 17\n      }, this), questions.map((q, qid) => /*#__PURE__*/_jsxDEV(Question, {\n        options: q.options,\n        question: q.question,\n        id: qid,\n        onSelect: setAnswerFromChild\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 21\n      }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: submitSurvey,\n        children: \"submit\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this), error]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"linkToCheckResults\",\n      children: /*#__PURE__*/_jsxDEV(Link, {\n        to: `/ViewResults/${currentPoll}`,\n        className: \"poll\",\n        children: \"Check Results\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 13\n  }, this);\n}\n\n_s(Survey, \"yrWrbnXtndfunWTE1jTIMEfIgHc=\");\n\n_c = Survey;\nexport default Survey;\n\nvar _c;\n\n$RefreshReg$(_c, \"Survey\");","map":{"version":3,"sources":["/Users/mandyhe/cs0320/term-project-awhite35-mcamach6-mhe26-pmontei1/frontend/src/survey_display/Survey.js"],"names":["Question","React","useState","useEffect","Link","firebase","axios","fire","Survey","props","title","setTitle","surveyCreator","setCreator","description","setDescription","questions","setQuestions","userAnswers","setUserAnswers","error","setError","db","firestore","currentPoll","uniqueID","loadSurvey","doc","collection","get","data","creator","ndoc","orderBy","docs","map","d","answers","Array","length","console","log","i","auth","currentUser","uid","exists","document","getElementById","style","visibility","sendResults","responsesRef","set","userID","email","name","displayName","responses","then","catch","setAnswerFromChild","questionID","answer","submitSurvey","valid","id","q","qid","options","question"],"mappings":"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","sourcesContent":["import Question from \"./Question\";\nimport React, {useState, useEffect} from 'react';\nimport {Link} from 'react-router-dom'\nimport firebase from \"firebase\";\nimport axios from \"axios\";\nimport fire from '../fire'\nimport \"./Survey.css\"\n\nfunction Survey(props) {\n    const [title, setTitle] = useState(\"loading...\");\n    const [surveyCreator, setCreator] = useState(\"\"); // use this to check if button should show up\n    const [description, setDescription] = useState(\"almost there...\");\n    const [questions, setQuestions] = useState([]);\n    const [userAnswers, setUserAnswers] = useState([]);\n    const [error, setError] = useState(\"\");\n\n\n    const db = firebase.firestore();\n    const currentPoll = props.uniqueID;\n\n    const loadSurvey = async () => {\n        const doc = await db.collection(\"surveys\").doc(currentPoll).get();\n        setTitle(doc.data().title);\n        setCreator(doc.data().creator); // sets creator --> if current user matches this, display button to get results\n        setDescription(doc.data().description);\n        const ndoc = await db.collection(\"surveys\").doc(currentPoll).collection(\"questions\").orderBy(\"questionnumber\").get();\n        await setQuestions(ndoc.docs.map(d => d.data()));\n        let answers = new Array(ndoc.docs.length);\n        // store answer as -1 if user hasn't answered\n        console.log(answers.length);\n        for (let i = 0; i < answers.length; i++) {\n            answers[i] = -1;\n        }\n        setUserAnswers(answers);\n\n        if ((await\n            db.collection(\"surveys\").doc(currentPoll).collection(\"responses\").doc(firebase.auth()\n                .currentUser.uid).get()).exists) {\n            document.getElementById(\"linkToCheckResults\").style.visibility = \"visible\";\n        }\n    }\n\n    const sendResults = async () => {\n        // make a new document for submitting\n\n        // makes the document id the same as the user id and also overrides previous changes if the user\n        // submits twice\n        let responsesRef = db.collection(\"surveys\").doc(currentPoll).collection(\"responses\");\n\n        await responsesRef.doc(firebase.auth().currentUser.uid).set({\n            userID: firebase.auth().currentUser.uid,\n            email: firebase.auth().currentUser.email,\n            name: firebase.auth().currentUser.displayName,\n            responses: userAnswers\n        }).then(() => {\n            setError(\"Successfully submitted survey response!\");\n            document.getElementById(\"linkToCheckResults\").style.visibility = \"visible\";\n\n            console.log(\"submitted survey response!\");\n\n        }).catch((error) => {\n            console.error(\"Error making survey: \", error);\n            setError(\"Error submitting survey: \" + error);\n        });\n\n        // should we add a timestamp?\n    }\n\n\n    // on page load, load in the survey\n    useEffect(() => {\n        loadSurvey();\n    }, [])\n\n\n    // set ID, used in child component\n    const setAnswerFromChild = (questionID, answer) => {\n        if (userAnswers) {\n            userAnswers[questionID] = answer;\n        }\n    }\n\n    // attempt to submit survey\n    const submitSurvey = () => {\n        console.log(userAnswers);\n\n        // make sure each answer isn't null\n        let valid = true;\n        for (let i = 0; i < userAnswers.length; i++) {\n            if (userAnswers[i] === -1) {\n                valid = false;\n            }\n        }\n\n\n        if (valid) {\n            console.log(\"attempting to submit...\");\n            sendResults();\n        } else {\n            console.log(\"you didn't pick answer choices :(\");\n            setError(\"Please answer every question!\");\n        }\n    }\n\n    // checking if user is admin is hard coded in --> will be used to display button for survey results.\n    console.log(db.collection(\"surveys\").doc(currentPoll).id)\n    return (<div className=\"div1\">\n            <div className=\"poll\">\n                <div className=\"surveyInfo\">\n                    <h1>{title}</h1>\n                    <p>{description}</p>\n                </div>\n                {questions.map((q, qid) =>\n                    <Question options={q.options} question={q.question} id={qid} onSelect={setAnswerFromChild}/>\n                )}\n                <button type=\"button\" onClick={submitSurvey}>submit</button>\n                {error}\n            </div>\n            <div id=\"linkToCheckResults\">\n                <Link to={`/ViewResults/${currentPoll}`} className=\"poll\">Check Results</Link>\n            </div>\n\n        </div>\n    )\n}\n\nexport default Survey;"]},"metadata":{},"sourceType":"module"}