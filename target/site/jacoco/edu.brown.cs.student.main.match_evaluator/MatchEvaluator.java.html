<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MatchEvaluator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stars</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs.student.main.match_evaluator</a> &gt; <span class="el_source">MatchEvaluator.java</span></div><h1>MatchEvaluator.java</h1><pre class="source lang-java linenums">package edu.brown.cs.student.main.match_evaluator;


import edu.brown.cs.student.main.stable_roommates.Person;
import edu.brown.cs.student.main.survey.Answer;
import edu.brown.cs.student.main.survey.Question;

import java.util.ArrayList;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class MatchEvaluator {
  private List&lt;Question&gt; questions;
  private Map&lt;Person, List&lt;Answer&gt;&gt; personToAnswers;

  // DATA IS IN FORM:
  // first element is &quot;ID&quot; of person, next are question answers.
  // -1,q1,q2,q3,...
  // 0 a1,a2,a3,...
  // 1 a1,a2,a3...
<span class="fc" id="L23">  public MatchEvaluator(List&lt;Question&gt; questions, Map&lt;Person, List&lt;Answer&gt;&gt; personToAnswers) {</span>
<span class="fc" id="L24">    this.questions = questions;</span>
<span class="fc" id="L25">    this.personToAnswers = personToAnswers;</span>

<span class="fc" id="L27">  }</span>

  /**
   * Gets all the info -- answers from each user who took survey -- evaluates similarity.
   * @return a hashmap mapping ids to a list of their matches sorted
   */
  public Map&lt;Person, List&lt;Person&gt;&gt; evaluateMatches() {
<span class="fc" id="L34">    Map&lt;Person, List&lt;Person&gt;&gt; finalMatches = new HashMap&lt;&gt;();</span>
<span class="fc" id="L35">    List&lt;Question&gt; questionInfo = this.questions;</span>

    // starts iterating from the second row(first row is reserved for questions)
<span class="fc bfc" id="L38" title="All 2 branches covered.">    for (Person currPerson : this.personToAnswers.keySet()) {</span>
      // stores list of ids that represent the similarity
<span class="fc" id="L40">      List&lt;PersonToScore&gt; idScorePairs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L41">      List&lt;Answer&gt; currPersonsAnswers = this.personToAnswers.get(currPerson);</span>

      // goes through each person who took the survey
      // if not the same person, calculate score
      // score will be [id, score] and put into similarity array
<span class="fc bfc" id="L46" title="All 2 branches covered.">      for (Person potMatch : this.personToAnswers.keySet()) {</span>
<span class="fc bfc" id="L47" title="All 2 branches covered.">        if (!currPerson.equals(potMatch)) {</span>
<span class="fc" id="L48">          List&lt;Answer&gt; pot = this.personToAnswers.get(potMatch);</span>
<span class="fc" id="L49">          double id = potMatch.getId();</span>
<span class="fc" id="L50">          double potScore = getScore(currPersonsAnswers, pot, questionInfo);</span>

<span class="fc" id="L52">          PersonToScore pair = new PersonToScore(potMatch, potScore);</span>
<span class="fc" id="L53">          idScorePairs.add(pair);</span>
        }
<span class="fc" id="L55">      }</span>

      // sort the array of [id, score] pairs based off score
      // when sorted --&gt; go through each element and add to list
      // so this will give us a list of IDs based on order of score
<span class="fc" id="L60">      idScorePairs.sort((a, b) -&gt; Double.compare(b.getScore(), a.getScore()));</span>
<span class="fc" id="L61">      List&lt;Person&gt; sortedIDs = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">      for (PersonToScore pairs : idScorePairs) {</span>
<span class="fc" id="L63">        sortedIDs.add(pairs.getPerson());</span>
<span class="fc" id="L64">      }</span>

      // add to hashmap
      // will have ID --&gt; List of sorted IDs
      // the first id being most similar
<span class="fc" id="L69">      finalMatches.put(currPerson, sortedIDs);</span>
<span class="fc" id="L70">    }</span>
<span class="fc" id="L71">    return finalMatches;</span>
  }

  /**
   * Calculates similarity score based off two people and the points for each question.
   *
   * @param person1      - list of answers one user had
   * @param person2      - list of answers another user had
   * @param questionList - a list of questions; score of each question -- add to total score if answers are the same
   * @return total score
   */
  public double getScore(List&lt;Answer&gt; person1, List&lt;Answer&gt; person2, List&lt;Question&gt; questionList) {
<span class="fc" id="L83">    int totalScore = 0;</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">    for (int i = 1; i &lt; person1.size(); i++) {</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">      if (person1.get(i).equals(person2.get(i))) {</span>
<span class="fc" id="L86">        totalScore += questionList.get(i).getScore();</span>
      }
    }

<span class="fc" id="L90">    return totalScore;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>